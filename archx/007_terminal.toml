version = 1
description = "Configuring terminal"

# Install zsh
[[packages]]
names = ["zsh"]

# Install Oh My Zsh (skips if already installed)
[[shell]]
script = """
if [ -d "$HOME/.oh-my-zsh" ]; then
  echo 'Oh My Zsh is already installed; skipping.'
  exit 0
fi
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
"""

# Install custom plugins
[[shell]]
script = """
ZSH_CUSTOM="${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}"
for repo in zsh-users/zsh-autosuggestions zsh-users/zsh-syntax-highlighting; do
  name=$(basename "$repo")
  dest="$ZSH_CUSTOM/plugins/$name"
  if [ -d "$dest" ]; then
    echo "$name already installed; skipping."
    continue
  fi
  git clone "https://github.com/$repo.git" "$dest"
done
"""

# Set zsh as default shell (skips if already set)
[[shell]]
script = """
if [ "$(basename "$SHELL")" = "zsh" ]; then
  echo 'zsh is already the default shell; skipping.'
  exit 0
fi
chsh -s $(which zsh)
"""

# Symlink .zshrc
[[symlink]]
source = "dotfiles/zsh/.zshrc"
target = "~/.zshrc"
